---
title: "HW 03: "
subtitle: Physical activity and access to recreational facilities in Cook County, Chicago
bibliography: references.bib
---

::: callout-important
## Due date

This assignment is due on **Thursday, February 27 at 11:45am.** To be considered on time, the following must be done by the due date:

-   Final `.qmd` and `.pdf` files pushed to your GitHub repo
-   Final `.pdf` file submitted on Gradescope
:::

# **Getting started**

-   Go to the [biostat725-sp25](https://www.github.com/biostat725-sp25) organization on GitHub. Click on the repo with the prefix **hw-03**. It contains the starter documents you need to complete the homework.

-   Clone the repo and start a new project in RStudio. See the [AE 01 instructions](https://biostat725-sp25.netlify.app/ae/ae-01-mcmc#clone-the-repo-start-new-rstudio-project) for details on cloning a repo and starting a new project in R.

# Packages

The following packages are used in this assignment:

```{r}
#| eval: true
#| message: false

library(tidyverse)
library(rstan)
library(bayesplot)
library(knitr)
library(loo)

# load other packages as needed
```

# Introduction

This homework will use data from the [Hospital, Doctor, Patient (HDP) dataset](https://stats.oarc.ucla.edu/r/codefragments/mesimulation/). The is a simulated study that is meant to be a large study of lung cancer outcomes across multiple doctors and sites. Assume that the variables were collected prior to a lung cancer surgery. Our primary outcome in this homework is the hospital length of stay (`LengthofStay`) following the surgery.  We will use the following variables from the dataset:

-   `Age`: continuous, age in years.

-   `Married`: binary, married/living with partner of single.

-   `FamilyHx`: binary (yes/no), does the patient have a family history (Hx) of cancer?

-   `SmokingHx`: categorical with three levels, current smoker, former smoker, never smoked.

-   `Sex`: binary (female/male).

-   `CancerStage`: categorical with four levels, stages 1-4.

-   `LengthofStay`: count number of days patients stayed in the hospital after surgery.

-   `WBC`: continuous, white blood count.

-   `RBC`: continuous, red blood count.

-   `BMI`: body mass index given by the formula ($kg/m^2$).

-   `IL6`: continuous, interleukin 6, a proinflammatory cytokine commonly examined as an indicator of inflammation, cannot be lower than zero.

-   `CRP`: continuous, C-reactive protein, a protein in the blood also used as an indicator of inflammation.

For our homework we will use the `hdp` dataset from the `MLMusingR` R package. The dataset can be loaded as follows. Note that we will work with a subsample of 1,000 patients.

```{r}
library(MLMusingR)
set.seed(54)
hdp <- hdp[sample(1:nrow(hdp), size = 1000, replace = TRUE), ]
```

## Exercise 1

Researchers are interested in the association between the predictors: sex, marital status, and smoking history, and the outcome: BMI. They start by visualizing the distribution of BMI and notice that it is a bit right-skewed; and thus they are worried about performing linear regression. Instead they would like to perform median regression.

```{r}
#| echo: false
#| message: false
#| fig-align: "center"
#| fig-height: 4
#| fig-width: 4
#| layout-nrow: 1
#| layout-ncol: 1
ggplot(hdp, aes(x = BMI)) + 
  geom_histogram() + 
  labs(x = expression(paste("BMI (kg/", m^2, ")")),
       y = "Count",
       subtitle = "Distribution of BMI prior to lung cancer surgery")
```

Setup a multivariable median regression model to estimate the association between the predictors: sex, marital status, and smoking history, and the outcome: BMI. Define the random variable $Y_i$ as the BMI in $kg/m^2$ for patient $i$ and the median quantile of $Y_i$ given predictors $\mathbf{x}_i$ as $q({Y_i|\mathbf{x}_i})$. We will model the median quantile as a linear function of the predictors,
$$q({Y_i|\mathbf{x}_i}) = \alpha + \mathbf{x}_i\boldsymbol{\beta},$$
where $\mathbf{x}_i = (male_i, married_i, current\_smoker_i, former\_smoker_i).$ Each of these predictors is just a binary variable. 

Formulate this regression problem within the framework of a Bayesian model (hint: Laplace distribution!). Fit this regression using Stan to estimate $(\alpha, \boldsymbol{\beta})$ and any other parameters that arise in the model. For all model parameters, choose weakly-informative priors. Evaluate model convergence.


## Exercise 2

Perform a posterior predictive check using the median as a test statistic. Be sure to present a posterior predictive p-value and use it to describe the model fit.

## Exercise 3

Present posterior summaries for all population parameters. For all predictors with a significant association (i.e., 95% credible interval does not include zero), provide an interpretation within the context of the problem. 

## Exercise 2

## Exercise 3

## Exercise 4

## Exercise 5

## Exercise 6

## Exercise 7

## Exercise 8

## Exercise 9

::: render-commit-push
You’re done and ready to submit your work! render, commit, and push all remaining changes. You can use the commit message “Done with Homework 2!”, and make sure you have pushed all the files to GitHub (your Git pane in RStudio should be empty) and that [all]{.underline} documents are updated in your repo on GitHub. The PDF document you submit to Gradescope should be identical to the one in your GitHub repo.
:::

# Submission

You will submit the PDF documents for homeworks, and exams in to Gradescope as part of your final submission.

::: callout-warning
Before you wrap up the assignment, make sure all documents are updated on your GitHub repo. We will be checking these to make sure you have been practicing how to commit and push changes.

Remember – you must turn in a PDF file to the Gradescope page before the submission deadline for full credit.
:::

To submit your assignment:

-   Access Gradescope through the menu on the [BIOSTAT 725 Canvas site.](https://canvas.duke.edu/courses/53305)

-   Click on the assignment, and you’ll be prompted to submit it.

-   Mark the pages associated with each exercise. All of the pages of your homework should be associated with at least one question (i.e., should be “checked”).

# Grading

| Component | Points |
|:----------|:-------|
| Ex 1      | 8      |
| Ex 2      | 8      |
| Ex 3      | 4      |
| Ex 4      | 4      |
| Ex 5      | 3      |
| Ex 6      | 5      |
| Ex 7      | 6      |
| Ex 8      | 7      |
| Ex 9      | 5      |

{
  "hash": "367c83fb9bf3325e4f8183113e4f2198",
  "result": {
    "markdown": "---\ntitle: \"Lab 05: Candy Competition\"\nsubtitle: \"Feature engineering + Model comparison\"\nexecute:\n  freeze: auto\n  echo: true\n  eval: false\n  warning: false\n  message: false\n---\n\n\n::: callout-important\nDue:\n\n-   Friday, October 20, 11:59pm (Tuesday labs)\n-   Friday, October 20, 11:59pm (Thursday labs)\n:::\n\n## Introduction\n\nIn today's lab you will analyze data about candy that was collected from an online experiment conducted at [FiveThirtyEight](https://fivethirtyeight.com/).\n\n### Learning goals\n\nBy the end of the lab you will be able to\n\n-   describe the components of a recipe\n-   fit a model using recipes\n-   compare models\n-   continue developing a collaborative workflow with your teammates\n\n## Getting started\n\n-   A repository has already been created for you and your teammates. Everyone in your team has access to the same repo.\n-   Go to the [sta210-fa23](https://github.com/sta210-fa23) organization on GitHub. Click on the repo with the prefix **lab-05**. It contains the starter documents you need to complete the lab.\n-   Each person on the team should clone the repository and open a new project in RStudio. Throughout the lab, each person should get a chance to make commits and push to the repo.\n-   **Do not make any changes to the `.qmd` file until the instructions tell you do to so.**\n\n## Workflow: Using Git and GitHub as a team\n\n::: callout-important\nThere are no Team Member markers in this lab; however, you should use a similar workflow as in Lab 04. Only one person should type in the group's .qmd file at a time. Once that person has finished typing the group's responses, they should *render, commit, and push* the changes to GitHub. All other teammates can *pull* to see the updates in RStudio.\n\nEvery teammate must have at least one commit in the lab. Everyone is expected to contribute to discussion even when they are not typing.\n:::\n\n## Packages\n\nThe following packages are used in the lab.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(tidymodels)\nlibrary(fivethirtyeight)\nlibrary(knitr)\n\n# add other packages as needed\n```\n:::\n\n\n## Data: Candy\n\nThe data from this lab comes from the the article FiveThirtyEight [*The Ultimate Halloween Candy Power Ranking*](https://fivethirtyeight.com/features/the-ultimate-halloween-candy-power-ranking) by Walt Hickey. To collect data, Hickey and collaborators at FiveThirtyEight set up an experiment people could vote on a series of randomly generated candy matchups (e.g. Reeses vs. Skittles). Click [here](http://walthickey.com/2017/10/18/whats-the-best-halloween-candy/) to check out some of the match ups.\n\nThe data set contains the characteristics and win percentage from 85 candies in the experiment. The variables are\n\n| Variable           | Description                                                               |\n|--------------------|---------------------------------------------------------------------------|\n| `chocolate`        | Does it contain chocolate?                                                |\n| `fruity`           | Is it fruit flavored?                                                     |\n| `caramel`          | Is there caramel in the candy?                                            |\n| `peanutalmondy`    | Does it contain peanuts, peanut butter or almonds?                        |\n| `nougat`           | Does it contain nougat?                                                   |\n| `crispedricewafer` | Does it contain crisped rice, wafers, or a cookie component?              |\n| `hard`             | Is it a hard candy?                                                       |\n| `bar`              | Is it a candy bar?                                                        |\n| `pluribus`         | Is it one of many candies in a bag or box?                                |\n| `sugarpercent`     | The percentile of sugar it falls under within the data set. Values 0 - 1. |\n| `pricepercent`     | The unit price percentile compared to the rest of the set. Values 0 - 1.  |\n| `winpercent`       | The overall win percentage according to 269,000 matchups. Values 0 - 100. |\n\nUse the code below to get a glimpse of the `candy_rankings` data frame in the **fivethirtyeight** R package.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nglimpse(candy_rankings)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nRows: 85\nColumns: 13\n$ competitorname   <chr> \"100 Grand\", \"3 Musketeers\", \"One dime\", \"One quarter…\n$ chocolate        <lgl> TRUE, TRUE, FALSE, FALSE, FALSE, TRUE, TRUE, FALSE, F…\n$ fruity           <lgl> FALSE, FALSE, FALSE, FALSE, TRUE, FALSE, FALSE, FALSE…\n$ caramel          <lgl> TRUE, FALSE, FALSE, FALSE, FALSE, FALSE, TRUE, FALSE,…\n$ peanutyalmondy   <lgl> FALSE, FALSE, FALSE, FALSE, FALSE, TRUE, TRUE, TRUE, …\n$ nougat           <lgl> FALSE, TRUE, FALSE, FALSE, FALSE, FALSE, TRUE, FALSE,…\n$ crispedricewafer <lgl> TRUE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE…\n$ hard             <lgl> FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALS…\n$ bar              <lgl> TRUE, TRUE, FALSE, FALSE, FALSE, TRUE, TRUE, FALSE, F…\n$ pluribus         <lgl> FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, TRUE…\n$ sugarpercent     <dbl> 0.732, 0.604, 0.011, 0.011, 0.906, 0.465, 0.604, 0.31…\n$ pricepercent     <dbl> 0.860, 0.511, 0.116, 0.511, 0.511, 0.767, 0.767, 0.51…\n$ winpercent       <dbl> 66.97173, 67.60294, 32.26109, 46.11650, 52.34146, 50.…\n```\n:::\n:::\n\n\n## Exercises\n\nThe goal of this analysis is to use multiple linear regression to understand the factors that make a good candy.\n\n### Exercise 1\n\n-   Use `ggplot` to make a graph of your choice exploring the relationship between at least 3 variables in the data set.\n\n-   Write two observations from your graph.\n\n### Exercise 2\n\nSplit the data into training (80%) and testing sets (20%). Call the training set `candy_train` and the testing set `candy_test`. Use a seed of `2`.\n\n### Exercise 3\n\nBelow is a recipe for a model that uses the characteristics of candy to understand variability in the win percentage. The lines of the `recipe` code are labeled *Line 1* - *Line 9.* Describe what each line of code does. The explanation should be written comprehensively and specifically enough that someone could replicate the data manipulation steps based on your description.\n\nFor example, if a line of code is `step_center(X)`, a comprehensive and specific explanation something similar to the following: \"This line of code mean centers the variable $X$ by subtracting $\\bar{X}$ from each value of $X$ in the training data.\"\n\n::: callout-tip\nUse the [Recipes Function Reference](https://recipes.tidymodels.org/reference/index.html) page as a resource to learn more about the `step_` functions.\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#Line 1\ncandy_rec <- recipe(winpercent ~ ., data = candy_train) |> \n#Line 2\n  update_role(competitorname, new_role = \"ID\") |> \n# Line 3\n  step_cut(sugarpercent, breaks = c(0, 0.25, 0.5, 0.75, 1)) |> \n#Line 4\n  step_mutate(pricepercent = pricepercent * 100) |> \n#Line 5\n  step_dummy(all_nominal_predictors()) |> \n#Line 6\n  step_interact(terms =~ pricepercent:chocolate) |> \n#Line 7\n  step_interact(terms =~ peanutyalmondy:chocolate) |> \n#Line 8\n  step_rm(fruity, caramel, hard, pluribus, bar, nougat, crispedricewafer) |> \n#Line 9\n  step_zv(all_predictors()) \n```\n:::\n\n\n### Exercise 4\n\nFill in the code to use `prep` and `bake` for a preview of what will happen when the recipe in Exercise 3 is applied.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncandy_rec |>\n  prep() |>\n  bake(_____) |>\n  glimpse()\n```\n:::\n\n\nHow many terms (not including the intercept) will be in the model produced by this recipe?\n\n### Exercise 5\n\nFill in the code to specify model, build the model workflow using the recipe in Exercise 2, and fit the model to the training data. Then, neatly display the model using 3 digits.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#specify the model\ncandy_spec <- linear_reg() |>\n  set_engine(\"lm\")\n\n#build model workflow\ncandy_workflow <- workflow() |>\n  add_model(_____) |>\n  add_recipe(_____) \n\n# fit the model \ncandy_fit <- candy_workflow |>\n  fit(data = _____)\n```\n:::\n\n\n### Exercise 6\n\nInterpret the following in the context of the data:\n\n-   Intercept\n\n-   Coefficient of `sugarpercent_X.0.75.1.`\n\n-   Coefficient of `pricepercent_x_chocolateTRUE`\n\n-   Effect of `pricepercent` for chocolate candy\n\n### Exercise 7\n\nLet's consider another model. Use the `recipe` workflow to fit a new model that meets the following criteria:\n\n-   Includes variables `chocolate`, `pricepercent`, `crispedricewafer`, `peanutyalmondy`, `sugarpercent`\n\n-   Update `pricepercent` so it ranges from 0 to 100 (instead of 0 to 1)\n\n-   Makes `sugarpercent` a factor where the levels equal the four quartiles: 0 - 0.25, 0.25 - 0.50, 0.50 - 0.75, 0.75 - 1\n\n-   Includes the interaction between `pricepercent` and `peanutyalmondy`\n\nNeatly display the model using 3 digits.\n\n::: callout-tip\nSee the [Function Reference](https://recipes.tidymodels.org/reference/index.html) page on [recipes.tidymodels.org](https://recipes.tidymodels.org) to find the appropriate recipe functions.\n:::\n\n### Exercise 8\n\n-   Consider the model from Exercise 5 \"Model 1\" and the model fit in Exercise 7 \"Model 2\". Use the `glance()` function to calculate $R^2$ for both of these models.\n\n-   Which model would you choose based on $R^2$? Briefly explain your choice.\n\n### Exercise 9\n\nWe will use RMSE to evalulate the predictive performance of each model on the testing data.\n\n-   Use the code below to calculate predicted values and RMSE for Model 1 on the testing data. Then get the RMSE for Model 2 on the testing data.\n\n\n::: {.cell}\n\n```{.r .cell-code}\npredict_test1 <- predict(candy_fit, candy_test) |> \n  bind_cols(candy_test)\n\nrmse1 <- rmse(predict_test1, truth = winpercent, estimate = .pred)\n```\n:::\n\n\n-   Which model would you choose based on RMSE on the testing data? Briefly explain your choice.\n\n### Exercise 10\n\n-   Use the model you selected in Exercise 9 to describe what generally makes a good candy, i.e., one with a high win percentage.\n\n## Submission\n\n::: callout-warning\nBefore you wrap up the assignment, make sure all documents are updated on your GitHub repo. We will be checking these to make sure you have been practicing how to commit and push changes.\n\nRemember -- you must turn in a PDF file to the Gradescope page before the submission deadline for full credit.\n:::\n\n**One team member submit the assignment:**\n\n-   Go to [http://www.gradescope.com](http://www.gradescope.com/) and log in using your NetID credentials.\n-   Click on your *STA 210* course.\n-   Click on the assignment, and you'll be prompted to submit it.\n-   Select all team members' names, so they receive credit on the assignment. [Click here](https://help.gradescope.com/article/m5qz2xsnjy-student-add-group-members) for video on adding team members to assignment on Gradescope.\n-   Mark the pages associated with each exercise. All of the pages of your lab should be associated with at least one question (i.e., should be \"checked\").\n-   Select the first page of your PDF submission to be associated with the *\"Workflow & formatting\"* section.\n\n## Grading\n\nTotal points available: 50 points.\n\n| Component             | Points |\n|-----------------------|--------|\n| Ex 1                  | 6      |\n| Ex 2                  | 3      |\n| Ex 3                  | 5      |\n| Ex 4                  | 1      |\n| Ex 5                  | 2      |\n| Ex 6                  | 8      |\n| Ex 7                  | 8      |\n| Ex 8                  | 4      |\n| Ex 9                  | 4      |\n| Ex 10                 | 4      |\n| Workflow & formatting | 5[^1]  |\n\n[^1]: The \"Workflow & formatting\" grade is to assess the reproducible workflow and collaboration. This includes having at least one meaningful commit from each team member and updating the team name and date in the YAML.\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}
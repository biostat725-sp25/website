{
  "hash": "a79021bf232044902c13c287d6412dea",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Multiclass Classification\"\nauthor: \"Prof. Sam Berchuck\"\ndate: \"2025-02-25\"\ndate-format: \"MMM DD, YYYY\"\nfooter: \"[ðŸ”— BIOSTAT 725 - Spring 2025](https://biostat725-sp25.netlify.app/)\"\nlogo: \"../images/logo.png\"\nformat: \n  revealjs:\n    theme: slides.scss\n    multiplex: false\n    transition: fade\n    slide-number: true\n    incremental: false \n    chalkboard: true\n    html-math-method: mathjax\nfilters:\n  - parse-latex\nexecute:\n  freeze: auto\n  echo: true\nknitr:\n  opts_chunk: \n    R.options:      \n    width: 200\nbibliography: references.bib\n---\n\n::: {.cell}\n\n:::\n\n\n\n## Review of last lecture\n\n-   Last, we learned about classification for binary and multiclass problems.\n\n## Missing data\n\n- Missing data can appear in the outcome and/or predictors.\n\n- We will write down some math for the missingness occuring in the outcome space.\n\n## Missing data framework {.midi}\n\n- We are interested in modeling a random variable $Y_{i}$, for $i \\in \\{1,\\ldots,n\\}$.\n\n- In a missing data setting, we only observe the outcome in subset of observations, $\\mathbf{Y}_{obs} = \\{Y_{i}:i \\in \\mathcal N_{obs}\\}$. \n\n  - $\\mathcal N_{obs}$ is the set of indeces in the observed set, such that $|\\mathcal N_{obs}|= n_{obs}$ is the number of observed data points.\n\n- The remaining observations are assumed to be missing and are contained in $\\mathbf{Y}_{mis} = \\{Y_{i}:i \\in \\mathcal N_{mis}\\}$. \n\n  - $\\mathcal N_{mis}$ is the set of indeces of the missing data and $|\\mathcal N_{mis}|= n_{mis}$ is the number of missing data points. \n\n- The full set of data is given by $\\mathbf{Y}=(\\mathbf{Y}_{obs},\\mathbf{Y}_{mis})$.\n\n## Missing data notation\n\n- Define $O_{i}$ as a binary indicator of observation $Y_{i}$ being present, where $O_{i} = 1$ indicates that $Y_{i}$ was observed. \n\n- The collection of missingness indicators is given by $\\mathbf{O} = \\{O_{i}:i = 1,\\ldots,n\\}$. \n\n- Our observed data then consists of $(\\mathbf{Y}_{obs}, \\mathbf{O})$.\n\n## Complete data likelihood\n\n- The joint distribution of $(\\mathbf{Y}, \\mathbf{O})$ can be written as,\n\n$$f(\\mathbf{Y}, \\mathbf{O} |  \\boldsymbol{\\theta},\\boldsymbol{\\phi}) = \\underbrace{f(\\mathbf{Y} | \\boldsymbol{\\theta})}_{\\text{likelihood}} \\times  \\underbrace{f(\\mathbf{O} | \\mathbf{Y}, \\boldsymbol{\\phi})}_{\\text{missing model}}.$$\n\n  - The parameter block, $(\\boldsymbol{\\theta},\\boldsymbol{\\phi})$, consists of: \n  \n    - $\\boldsymbol{\\theta}$, the **target parameters** of interest (e.g., feature effects on outcome), and \n    \n    - $\\boldsymbol{\\phi}$, the **nuisance parameters**.\n    \n. . .\n\n**Can we perform inference using this likelihood?**\n\n## Observed data likelihood \n\n- The likelihood for the observed data must be written by marginalizing over the unobserved outcome variables.\n\n\\begin{align*}\nf(\\mathbf{Y}_{obs}, \\mathbf{O} | \\boldsymbol{\\theta},\\boldsymbol{\\phi}) &= \\int f(\\mathbf{Y}_{obs}, \\mathbf{Y}_{mis}, \\mathbf{O} | \\boldsymbol{\\theta},\\boldsymbol{\\phi}) d\\mathbf{Y}_{mis}\\\\\n&= \\int f(\\mathbf{Y}, \\mathbf{O} | \\boldsymbol{\\theta},\\boldsymbol{\\phi}) d\\mathbf{Y}_{mis}\\\\\n&= \\int \\underbrace{f(\\mathbf{Y} | \\boldsymbol{\\theta}) f(\\mathbf{O} | \\mathbf{Y}, \\boldsymbol{\\phi})}_{\\text{complete data likelihood}} d\\mathbf{Y}_{mis}\n\\end{align*}\n\n## Missing data models: MCAR\n\nThe data are missing completely at random (MCAR) if the missing mechanism is defined as,\n\\begin{align*}\nf(\\mathbf{O} | \\mathbf{Y},\\boldsymbol{\\phi}) &= f(\\mathbf{O} | \\mathbf{Y}_{obs}, \\mathbf{Y}_{mis},\\boldsymbol{\\phi})\\\\\n&= f(\\mathbf{O} | \\boldsymbol{\\phi}).\n\\end{align*}\n\n- The missingness does not depend on any data.\n\n## Implications of the missing model: MCAR {.midi}\n\n\\begin{align*}\nf(\\mathbf{Y}_{obs}, \\mathbf{O} | \\boldsymbol{\\theta},\\boldsymbol{\\phi}) &= \\int f(\\mathbf{Y} | \\boldsymbol{\\theta}) f(\\mathbf{O} | \\mathbf{Y}, \\boldsymbol{\\phi}) d\\mathbf{Y}_{mis}\\\\\n&= \\int f(\\mathbf{Y} | \\boldsymbol{\\theta}) f(\\mathbf{O} | \\boldsymbol{\\phi}) d\\mathbf{Y}_{mis}\\\\\n&=  f(\\mathbf{O} | \\boldsymbol{\\phi}) \\int f(\\mathbf{Y}_{obs} | \\boldsymbol{\\theta}) f(\\mathbf{Y}_{mis} | \\boldsymbol{\\theta})d\\mathbf{Y}_{mis}\\\\\n&=  f(\\mathbf{Y}_{obs} | \\boldsymbol{\\theta})f(\\mathbf{O} | \\boldsymbol{\\phi})\\int  f(\\mathbf{Y}_{mis} | \\boldsymbol{\\theta}) d\\mathbf{Y}_{mis}\\\\\n&=  f(\\mathbf{Y}_{obs} | \\boldsymbol{\\theta})f(\\mathbf{O} | \\boldsymbol{\\phi}).\n\\end{align*}\n\n- Under the MCAR assumption, we are allowed to fit the complete case analysis. We can ignore the missing data model.\n\n## Missing data models: MAR\n\nThe data are missing at random (MAR) if the missing mechanism is defined as,\n\\begin{align*}\nf(\\mathbf{O} | \\mathbf{Y},\\boldsymbol{\\phi}) &= f(\\mathbf{O} | \\mathbf{Y}_{obs}, \\mathbf{Y}_{mis},\\boldsymbol{\\phi})\\\\\n&= f(\\mathbf{O} | \\mathbf{Y}_{obs},\\boldsymbol{\\phi}).\n\\end{align*}\n\n- The missingness depends on the observed data only.\n\n## Implications of the missing model: MAR {.midi}\n\n\\begin{align*}\nf(\\mathbf{Y}_{obs}, \\mathbf{O} | \\boldsymbol{\\theta},\\boldsymbol{\\phi}) &= \\int f(\\mathbf{Y} | \\boldsymbol{\\theta}) f(\\mathbf{O} | \\mathbf{Y}, \\boldsymbol{\\phi}) d\\mathbf{Y}_{mis}\\\\\n&= \\int f(\\mathbf{Y} | \\boldsymbol{\\theta}) f(\\mathbf{O} | \\mathbf{Y}_{obs}, \\boldsymbol{\\phi}) d\\mathbf{Y}_{mis}\\\\\n&=  f(\\mathbf{O} | \\mathbf{Y}_{obs},\\boldsymbol{\\phi}) \\int f(\\mathbf{Y}_{obs} | \\boldsymbol{\\theta}) f(\\mathbf{Y}_{mis} | \\boldsymbol{\\theta})d\\mathbf{Y}_{mis}\\\\\n&=  f(\\mathbf{Y}_{obs} | \\boldsymbol{\\theta})f(\\mathbf{O} |\\mathbf{Y}_{obs}, \\boldsymbol{\\phi})\\int  f(\\mathbf{Y}_{mis} | \\boldsymbol{\\theta}) d\\mathbf{Y}_{mis}\\\\\n&=  f(\\mathbf{Y}_{obs} | \\boldsymbol{\\theta})f(\\mathbf{O} |\\mathbf{Y}_{obs}, \\boldsymbol{\\phi}).\n\\end{align*}\n\n- Under the MAR assumption, we are allowed to fit the complete case analysis. We can ignore the missing data model.\n\n## Missing data models: MNAR\n\nThe data are missing not at random (MNAR) if the missing mechanism is defined as,\n\\begin{align*}\nf(\\mathbf{O} | \\mathbf{Y},\\boldsymbol{\\phi}) &= f(\\mathbf{O} | \\mathbf{Y}_{obs}, \\mathbf{Y}_{mis},\\boldsymbol{\\phi}).\n\\end{align*}\n\n- The missingness depends on the observed and missing data.\n\n## Implications of the missing model: MNAR {.midi}\n\n\\begin{align*}\nf(\\mathbf{Y}_{obs}, \\mathbf{O} | \\boldsymbol{\\theta},\\boldsymbol{\\phi}) &= \\int f(\\mathbf{Y} | \\boldsymbol{\\theta}) f(\\mathbf{O} | \\mathbf{Y}, \\boldsymbol{\\phi}) d\\mathbf{Y}_{mis}\\\\\n&= \\int f(\\mathbf{Y} | \\boldsymbol{\\theta}) f(\\mathbf{O} | \\mathbf{Y}_{obs},\\mathbf{Y}_{mis}, \\boldsymbol{\\phi}) d\\mathbf{Y}_{mis}\\\\\n&= \\int f(\\mathbf{Y}_{obs} | \\boldsymbol{\\theta}) f(\\mathbf{Y}_{mis} | \\boldsymbol{\\theta})f(\\mathbf{O} | \\mathbf{Y},\\boldsymbol{\\phi})d\\mathbf{Y}_{mis}\\\\\n&= f(\\mathbf{Y}_{obs} | \\boldsymbol{\\theta}) \\int f(\\mathbf{Y}_{mis} | \\boldsymbol{\\theta})f(\\mathbf{O} | \\mathbf{Y},\\boldsymbol{\\phi})d\\mathbf{Y}_{mis}\\\\\n\n\\end{align*}\n\n- Under the MNAR assumption, we are NOT allowed to ignore the missing data. We must specify a model for the missing data.\n\n## Summary of missing mechanisms\n\n- Under MAR and MCAR, we are allowed to fit our model to the observed data (i.e., a complete case analysis/listwise deletion). Under these settings the missingness is considered **ignorable**.\n\n- Under MNAR, we must model the missing data mechanism. This data is considered **non-ignorable**.\n\n\n## Generating data\n\n- We want to have data under the following criteria:\n\n  1. Full data\n  \n  2. MCAR data\n  \n  3. MAR data\n  \n  4. MNAR data\n  \n- We then want to fit the following models: Complete case analysis, full Bayesian model, mice version. \n\n## Next\n\nThere are many ways to handle missing data. The simplest approach is to perform a complete case analysis, where we delete entries with a missing value for at least one variable. If the data are missing completely at random (MCAR), then we get unbiased parameter estimate. However:\n\nCredible intervals will usually be too wide, since the sample size has effectively been reduced (drastically).\nIf missing values occur for other reasons, this yields biased estimates.\nThe next step up is instead of dropping all the missing entries, we replace missing values of a feature with the mean or median of available values for the feature. This is called single mean/median imputation, and is often recommended in many machine learning tasks if the data are MCAR as it can still lead to unbiased parameter estimates.\n\nThere are also some drawbacks with this method, especially if youâ€™re interested in studying the variability. Single mean/median imputation artificially reduces the variance of features, which results in credible intervals which are too narrow. As shown in Figure 2, the peak at the mean is much higher relative to the surrounding values. The mean of the distribution can still be estimated appropriately, but the amount of spread is reduced.\n\nAnother drawback is it doesnâ€™t account for relationship between variables, thus reduces correlation. For example, the correlation between the two variables is 0.665 if we only look at the complete cases. If we use single mean imputation, the correlation decreases to 0.589.\n\nNote that if you donâ€™t care about assessing variability in your estimates, which is often the case for classification tasks, then mean imputation can work quite well.\n\n\n## Let's look at some data\n\n\n\n::: {.cell}\n\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(openintro)\nfulldata <- data.frame(y = bdims$wgt,\n                       x = bdims$hgt)\n```\n:::\n\n::: {.cell layout-ncol=\"1\" layout-align=\"center\"}\n::: {.cell-output-display}\n![](14-missing_files/figure-revealjs/unnamed-chunk-4-1.png){fig-align='center' width=960}\n:::\n:::\n\n\n\n## Simulate missing data\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(mice)\nset.seed(54)\nmissing_prop <- 0.5\npattern <- data.frame(y = c(0), x = c(1))\nmcardata <- ampute(fulldata, \n                   prop = missing_prop, \n                   patterns = pattern,\n                   mech = \"MCAR\")\nmardata <- ampute(fulldata, \n                   prop = missing_prop, \n                   patterns = pattern,\n                   mech = \"MAR\")\nmnardata <- ampute(fulldata, \n                  prop = missing_prop, \n                  patterns = pattern,\n                  mech = \"MNAR\")\n```\n:::\n\n\n\n## Visualize data\n\n\n\n::: {.cell layout-ncol=\"2\" layout-align=\"center\"}\n::: {.cell-output-display}\n![](14-missing_files/figure-revealjs/unnamed-chunk-6-1.png){fig-align='center' width=384}\n:::\n\n::: {.cell-output-display}\n![](14-missing_files/figure-revealjs/unnamed-chunk-6-2.png){fig-align='center' width=384}\n:::\n\n::: {.cell-output-display}\n![](14-missing_files/figure-revealjs/unnamed-chunk-6-3.png){fig-align='center' width=384}\n:::\n\n::: {.cell-output-display}\n![](14-missing_files/figure-revealjs/unnamed-chunk-6-4.png){fig-align='center' width=384}\n:::\n:::\n\n\n\n## Model fits\n\n\n\n::: {.cell layout-ncol=\"2\" layout-align=\"center\"}\n::: {.cell-output-display}\n![](14-missing_files/figure-revealjs/unnamed-chunk-7-1.png){fig-align='center' width=384}\n:::\n\n::: {.cell-output-display}\n![](14-missing_files/figure-revealjs/unnamed-chunk-7-2.png){fig-align='center' width=384}\n:::\n\n::: {.cell-output-display}\n![](14-missing_files/figure-revealjs/unnamed-chunk-7-3.png){fig-align='center' width=384}\n:::\n\n::: {.cell-output-display}\n![](14-missing_files/figure-revealjs/unnamed-chunk-7-4.png){fig-align='center' width=384}\n:::\n:::\n\n\n\n## Complete-case model\n\n\\begin{align*}\nY_i &\\stackrel{ind}{\\sim} N(\\alpha + X_i \\beta, \\sigma^2), \\quad i \\in \\mathcal N_{obs}\\\\\n\\alpha &\\sim N(0,10)\\\\\n\\beta &\\sim N(0,10)\\\\\n\\sigma &\\sim \\text{Half-Normal}(0, 10)\n\\end{align*}\n\n## Full Bayesian model\n\n\\begin{align*}\nY_i &\\stackrel{ind}{\\sim} N(\\alpha + X_i \\beta, \\sigma^2), \\quad i \\in \\mathcal N_{obs}\\\\\nY_i &\\stackrel{ind}{\\sim} N(\\alpha + X_i \\beta, \\sigma^2), \\quad i \\in \\mathcal N_{mis}\\\\\n\\alpha &\\sim N(0,10)\\\\\n\\beta &\\sim N(0,10)\\\\\n\\sigma &\\sim \\text{Half-Normal}(0, 10)\n\\end{align*}\n\n\n## Missing pattern\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmd.pattern(mcardata$amp, rotate.names = TRUE)\n```\n\n::: {.cell-output-display}\n![](14-missing_files/figure-revealjs/unnamed-chunk-8-1.png){width=960}\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n    x   y    \n256 1   1   0\n251 1   0   1\n    0 251 251\n```\n\n\n:::\n:::\n\n\n\n## Prepare for next class\n\n-   Work on [HW 03](https://biostat725-sp25.netlify.app/hw/hw-03).\n\n-   Complete reading to prepare for next Tuesday's lecture\n\n-   Tuesday's lecture: Missing data\n",
    "supporting": [
      "14-missing_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}